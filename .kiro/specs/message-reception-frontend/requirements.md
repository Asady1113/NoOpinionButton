# 要件定義書

## 概要

この機能は、participant.vueページにメッセージ受信機能を実装します。参加者名の登録が完了した後、WebSocketに接続し、受信したメッセージを画面に表示するUIを提供します。実装は既存のフロントエンドアーキテクチャパターンに従い、Vue 3 Composition APIとTailwind CSSを使用します。

## 要件

### 要件1

**ユーザーストーリー:** 参加者として、参加者名の登録が完了した後にWebSocketに自動接続したい。これにより、リアルタイムでメッセージを受信できる。

#### 受け入れ基準

1. WHEN 参加者名の登録が正常に完了する THEN システムはWebSocketに自動的に接続する必要がある
2. WHEN WebSocketに接続する THEN システムは指定されたURL形式（wss://0xjupqx66b.execute-api.ap-northeast-1.amazonaws.com/prod/?meetingId={MeetingId}&participantId={participantId}）を使用する必要がある
3. WHEN WebSocket接続を確立する THEN システムはmeetingIdとparticipantIdをクエリパラメータとして含める必要がある
4. WHEN WebSocket接続が成功する THEN システムは接続状態を管理する必要がある
5. WHEN WebSocket接続が失敗する THEN システムは適切なエラーハンドリングを行う必要がある

### 要件2

**ユーザーストーリー:** 参加者として、WebSocketから受信したメッセージを画面で確認したい。これにより、他の参加者からのメッセージをリアルタイムで見ることができる。

#### 受け入れ基準

1. WHEN WebSocketからメッセージを受信する THEN システムはMessageEntityの形式でメッセージデータを解析する必要がある
2. WHEN メッセージデータを受信する THEN システムはParticipantName、MessageContent、ParticipantId、CreatedAtを抽出する必要がある
3. WHEN 新しいメッセージを受信する THEN システムはメッセージリストに追加する必要がある
4. WHEN メッセージリストが更新される THEN システムはUIを自動的に更新する必要がある
5. WHEN 無効なメッセージ形式を受信する THEN システムは適切なエラーハンドリングを行う必要がある

### 要件3

**ユーザーストーリー:** 参加者として、受信したメッセージを見やすい形式で表示したい。これにより、誰がどのメッセージを送信したかを明確に識別できる。

#### 受け入れ基準

1. WHEN メッセージを表示する THEN システムは参加者IDを円形のアバターとして表示する必要がある
2. WHEN メッセージを表示する THEN システムはメッセージ内容を緑色の吹き出し形式で表示する必要がある
3. WHEN 複数のメッセージがある THEN システムは縦方向にリスト形式で表示する必要がある
4. WHEN メッセージリストが長くなる THEN システムはスクロール可能にする必要がある
5. WHEN 新しいメッセージが追加される THEN システムは最新のメッセージが見えるように自動スクロールする必要がある

### 要件4

**ユーザーストーリー:** 参加者として、WebSocket接続の状態を把握したい。これにより、メッセージ受信が正常に動作しているかを確認できる。

#### 受け入れ基準

1. WHEN WebSocket接続が確立される THEN システムは接続状態インジケーターを表示する必要がある
2. WHEN WebSocket接続が切断される THEN システムは切断状態を表示する必要がある
3. WHEN WebSocket接続が不安定な場合 THEN システムは再接続を試行する必要がある
4. WHEN 再接続が成功する THEN システムは正常状態に戻る必要がある
5. WHEN 再接続が失敗し続ける THEN システムはエラー状態を表示する必要がある

### 要件5

**ユーザーストーリー:** 開発者として、WebSocket機能を既存のアーキテクチャパターンに従って実装したい。これにより、コードの一貫性と保守性が保たれる。

#### 受け入れ基準

1. WHEN WebSocket機能を実装する THEN システムはVue 3 Composition APIを使用する必要がある
2. WHEN WebSocket接続を管理する THEN システムはcomposableパターンを使用する必要がある
3. WHEN エラーハンドリングを実装する THEN システムは既存のApiErrorタイプとエラーハンドリングパターンを使用する必要がある
4. WHEN UIコンポーネントを実装する THEN システムはTailwind CSSクラスを使用する必要がある
5. WHEN レスポンシブデザインを実装する THEN システムはモバイルデバイスでも動作する必要がある

