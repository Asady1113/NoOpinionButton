# Participant名前登録API 要件定義書

## 概要

会議参加者が自分の名前を変更・登録できるAPIを提供する。既存のParticipantエンティティのNameプロパティを更新する機能である。

## ユーザストーリー

### ストーリー: 参加者の名前登録

- **である** 会議参加者 **として**
- **私は** 自分の表示名を登録**をしたい**
- **そうすることで** 会議で適切な名前で表示される

## 機能要件（EARS記法）

### 通常要件

- REQ-001: システムは参加者IDと名前を受け取り、該当参加者の名前を登録しなければならない
- REQ-002: システムは更新処理の成功・失敗ステータスを返さなければならない
- REQ-003: システムは既存のクリーンアーキテクチャパターンに従って実装しなければならない

### 条件付き要件

- REQ-101: 参加者IDが存在しない場合、システムは404エラーを返さなければならない
- REQ-102: 名前が空文字列または無効な場合、システムは400エラーを返さなければならない
- REQ-103: DynamoDBの更新に失敗した場合、システムは500エラーを返さなければならない

### 状態要件

- REQ-201: 参加者が会議から離脱済み（IsActive=false）の場合は、システムは名前登録はできない

### 制約要件

- REQ-401: システムはParticipantNameバリューオブジェクトのバリデーション制約に従わなければならない
- REQ-402: システムはHTTP PUTメソッドでREST APIとして実装しなければならない
- REQ-403: システムはAWS Lambda関数として動作しなければならない

## 非機能要件

### パフォーマンス

- NFR-001: APIのレスポンス時間は3秒以内でなければならない
- NFR-002: DynamoDBの読み書き整合性を考慮した実装でなければならない

### セキュリティ

- NFR-101: 入力パラメータは適切にバリデーションされなければならない
- NFR-102: SQLインジェクション等の攻撃に対する保護が実装されていなければならない

### 可用性

- NFR-201: AWSサービスの一時的な障害に対する適切なエラーハンドリングが実装されていなければならない

## Edgeケース

### エラー処理

- EDGE-001: 参加者IDが存在しない場合の404エラー応答
- EDGE-002: 名前が空文字列・null・空白のみの場合の400エラー応答
- EDGE-003: 名前が最大文字数を超える場合の400エラー応答
- EDGE-004: DynamoDB接続エラーの場合の500エラー応答
- EDGE-005: 不正なJSON形式のリクエストの場合の400エラー応答

### 境界値

- EDGE-101: 名前の最小文字数（1文字）での正常処理
- EDGE-102: 名前の最大文字数での正常処理
- EDGE-103: Unicode文字（絵文字等）を含む名前での正常処理

### 同時実行

- EDGE-201: 同一参加者に対する複数の同時更新リクエスト処理
- EDGE-202: 他のAPI（サインイン等）との同時実行での整合性確保

## API仕様

### エンドポイント
- **Method**: PUT
- **Path**: `/participants/{participantId}/name`
- **Content-Type**: application/json

### リクエスト形式
```json
{
  "name": "更新したい参加者名"
}
```

### レスポンス形式

#### 成功時（200 OK）
```json
{
  "updatedName": "更新された名前"
}
```

#### エラー時
- **400 Bad Request**: バリデーションエラー
- **404 Not Found**: 参加者が存在しない
- **500 Internal Server Error**: サーバー内部エラー

```json
{
  "error": "エラーメッセージ"
}
```

## 受け入れ基準

### 機能テスト

- [ ] 有効な参加者IDと名前で正常に更新される
- [ ] 存在しない参加者IDで404エラーが返される
- [ ] 空文字列の名前で400エラーが返される
- [ ] null値の名前で400エラーが返される
- [ ] 最大文字数を超える名前で400エラーが返される
- [ ] Unicode文字を含む名前で正常に更新される
- [ ] DynamoDBエラー発生時に500エラーが返される

### 非機能テスト

- [ ] レスポンス時間が3秒以内である
- [ ] 同時リクエストが正しく処理される
- [ ] エラーログが適切に出力される

### アーキテクチャ適合性テスト

- [ ] 既存のクリーンアーキテクチャパターンに適合している
- [ ] 適切な層分離が実装されている
- [ ] DIコンテナが正しく設定されている
- [ ] バリューオブジェクトが適切に使用されている